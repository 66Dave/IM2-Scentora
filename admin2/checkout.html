<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scentora | Checkout</title>
  <link rel="stylesheet" href="/IM2-Scentora/files/admin/inventory.css" />
  <style>
    .checkout-container {
      max-width: 800px;
      margin: 40px auto 0 auto;
      padding: 2rem;
      background: var(--white);
      border-radius: 20px;
      box-shadow: var(--shadow);
    }

    .checkout-form {
      display: grid;
      gap: 1.5rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .form-group label {
      font-weight: 600;
      color: var(--primary);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 0.8rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
    }

    .order-summary {
      background: var(--accent);
      padding: 1.5rem;
      border-radius: 12px;
      margin-top: 2rem;
    }

    .place-order-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 8px;
      font-size: 1.1rem;
      cursor: pointer;
      width: 100%;
      margin-top: 1rem;
    }

    .order-item {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
      border-bottom: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">Scentora</div>
    <div class="header_contents">
      <div class="nav-links">
        <a href="dashboard.html">Dashboard</a>
        <a href="inventory_seller.html">Inventory</a>
        <a href="shop.html">Shop</a>
        <a href="cart.html">Cart</a>
        <a href="#logout" id="logout-link">Logout</a>
      </div>
      <div class="toggle-switch">
        <label for="darkmode">Dark mode</label>
        <input type="checkbox" id="darkmode" title="Toggle dark mode" />
      </div>
    </div>
  </header>

  <div class="checkout-container">
    <h2 style="color: var(--primary); margin-bottom: 2rem;">Checkout</h2>
    
    <form class="checkout-form" id="checkoutForm">
      <div class="form-group">
        <label for="shippingAddress">Shipping Address *</label>
        <textarea id="shippingAddress" name="shipping_address" rows="4" required 
                  placeholder="Enter your complete shipping address"></textarea>
      </div>

      <div class="form-group">
        <label for="paymentMethod">Payment Method</label>
        <select id="paymentMethod" name="payment_method">
          <option value="Cash on Delivery">Cash on Delivery</option>
          <option value="Credit Card">Credit Card</option>
          <option value="PayPal">PayPal</option>
          <option value="Bank Transfer">Bank Transfer</option>
        </select>
      </div>
    </form>

    <div class="order-summary">
      <h3 style="color: var(--primary); margin-bottom: 1rem;">Order Summary</h3>
      <div id="orderItems">
        <!-- Order items will be populated here -->
      </div>
      <div style="margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--primary);">
        <div style="display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold;">
          <span>Total: </span>
          <span>₱<span id="orderTotal">0.00</span></span>
        </div>
      </div>
      <button class="place-order-btn" onclick="placeOrder()">Place Order</button>
    </div>
  </div>

  <script>
    // Load cart items for checkout
    function loadCheckoutItems() {
      fetch('get_cart.php')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            displayOrderSummary(data.cart_items, data.total_amount);
          } else {
            alert('Failed to load cart items');
            window.location.href = 'cart.html';
          }
        });
    }

    function displayOrderSummary(items, total) {
      const orderItems = document.getElementById('orderItems');
      const orderTotal = document.getElementById('orderTotal');

      if (items.length === 0) {
        alert('Your cart is empty');
        window.location.href = 'cart.html';
        return;
      }

      orderTotal.textContent = total.toFixed(2);

      orderItems.innerHTML = items.map(item => `
        <div class="order-item">
          <span>${item.name} x ${item.quantity}</span>
          <span>₱${item.subtotal.toFixed(2)}</span>
        </div>
      `).join('');
    }

    function placeOrder() {
      const form = document.getElementById('checkoutForm');
      const formData = new FormData(form);

      if (!form.checkValidity()) {
        alert('Please fill in all required fields');
        return;
      }

      fetch('checkout.php', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert(`Order placed successfully! Order ID: ${data.order_id}`);
          window.location.href = 'shop.html';
        } else {
          alert('Order failed: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while placing the order');
      });
    }

    // Dark mode and logout functionality
    const darkToggle = document.getElementById('darkmode');
    if (localStorage.getItem('scentoraDark') === '1') {
      document.body.classList.add('darkmode');
      darkToggle.checked = true;
    }
    darkToggle.addEventListener('change', () => {
      document.body.classList.toggle('darkmode', darkToggle.checked);
      localStorage.setItem('scentoraDark', darkToggle.checked ? '1' : '0');
    });

    document.getElementById("logout-link").onclick = function(e) {
      e.preventDefault();
      if (confirm("Are you sure you want to logout?")) {
        window.location.href = "/IM2-Scentora/files/admin/loginpage.html";
      }
    };

    // Load checkout items on page load
    document.addEventListener('DOMContentLoaded', loadCheckoutItems);
  </script>
</body>
</html>
