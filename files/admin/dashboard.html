<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scentora | Dashboard</title>
  <style>
    :root {
      --primary: #a182c9;
      --accent: #e5d6f7;
      --background: #f7f5fa;
      --card: #fff7ff;
      --sidebar: #efe2fa;
      --text: #392e44;
      --nav-bg: rgba(114, 69, 173, 0.7);
      --nav-blur: blur(10px);
      --white: #fff;
      --shadow: 0 2px 6px rgba(161,130,201,0.12);
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--background);
      color: var(--text);
      margin: 0;
      padding-top: 74px;
      transition: background 0.5s ease, color 0.5s ease;
    }

    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--nav-bg);
      backdrop-filter: var(--nav-blur);
      color: var(--white);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
    }
    
    .header_contents {
    display: flex;
    gap: 1.5rem;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      letter-spacing: 1px;
    }

    .nav-links {
      display: flex;
      gap: 1rem;
    }

    .nav-links a {
      text-decoration: none;
      color: var(--white);
      font-weight: 500;
      font-size: 1rem;
      padding: 0.4rem 1rem;
      border-radius: 999px;
      transition: all 0.3s ease;
    }

    .nav-links a:not([href="#logout"]).active {
      background: var(--white);
      color: var(--primary);
      font-weight: 600;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
    }

    .nav-links a:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .toggle-switch {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .toggle-switch label {
      font-size: 0.96rem;
      color: var(--white);
    }

    .toggle-switch input[type="checkbox"] {
      width: 40px;
      height: 20px;
      appearance: none;
      background: #bda6e7;
      outline: none;
      border-radius: 15px;
      position: relative;
      transition: background 0.3s;
      cursor: pointer;
    }

    .toggle-switch input[type="checkbox"]:checked {
      background: #392e44;
    }

    .toggle-switch input[type="checkbox"]::before {
      content: "";
      position: absolute;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      top: 1px;
      left: 2px;
      background: #fff;
      transition: 0.3s;
    }

    .toggle-switch input[type="checkbox"]:checked::before {
      transform: translateX(19px);
      background: #a182c9;
    }

    .dashboard-container {
      display: flex;
      max-width: 1200px;
      margin: auto;
      padding: 2rem;
      gap: 2rem;
    }

    .sidebar {
      width: 220px;
      background: var(--sidebar);
      border-radius: 12px;
      padding: 1.4rem 1rem 1rem 1.4rem;
      box-shadow: var(--shadow);
      height: fit-content;
      margin-top: 0.5rem;
    }

    .sidebar h3 {
      color: var(--primary);
      margin-bottom: 1.1rem;
      letter-spacing: 1px;
    }

    .sidebar a {
      display: block;
      margin-bottom: 0.8rem;
      text-decoration: none;
      color: var(--text);
      font-weight: 500;
      border-radius: 4px;
      padding: 0.4rem 0.7rem;
      transition: background 0.2s;
      cursor: pointer;
    }

    .sidebar a.active,
    .sidebar a:hover {
      background: var(--primary);
      color: var(--white);
    }

    .dashboard-main {
      flex: 1;
    }

    .dashboard-page {
      display: none;
      animation: fadein 0.5s;
    }

    .dashboard-page.active {
      display: block;
    }

    .welcome-card {
      background: var(--card);
      padding: 2rem;
      border-radius: 16px;
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
      font-size: 1.2rem;
      text-align: center;
    }

    .quick-links {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .quick-link {
      background: var(--primary);
      color: var(--white);
      border-radius: 8px;
      padding: 1.2rem 2.5rem;
      text-decoration: none;
      font-size: 1.05rem;
      font-weight: 500;
      transition: background 0.2s, color 0.2s, transform 0.2s;
      box-shadow: var(--shadow);
    }

    .quick-link:hover {
      background: #8663b9;
      color: #f2e9ff;
      transform: translateY(-3px) scale(1.04);
    }

    .overview-grid {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 1rem;
    }

    .overview-widget {
      background: var(--accent);
      color: var(--primary);
      flex: 1 1 200px;
      min-width: 180px;
      padding: 1rem 1.2rem;
      border-radius: 10px;
      box-shadow: var(--shadow);
      text-align: center;
      font-size: 1.1rem;
      font-weight: 500;
    }

    .stat-card {
      background: var(--card);
      flex: 1 1 250px;
      padding: 1.2rem 1.5rem;
      border-radius: 12px;
      box-shadow: var(--shadow);
      min-width: 210px;
      text-align: center;
      transition: background 0.3s, color 0.3s;
    }

    .stat-card h4 {
      font-size: 1.08rem;
      color: #6b5097;
    }

    .stat-card p {
      font-size: 2.2rem;
      color: var(--primary);
      font-weight: bold;
      margin-top: 0.7rem;
    }

    body.darkmode {
      --primary: #b89fff;
      --accent: #2f2f4c;
      --background: #191922;
      --card: #232336;
      --sidebar: #232336;
      --text: #e9e9ff;
      --nav-bg: rgba(32, 31, 50, 0.92);
      --white: #e9e9ff;
      --shadow: 0 2px 16px rgba(17, 17, 22, 0.2);
    }

    @keyframes fadein {
      from { opacity: 0; }
      to   { opacity: 1; }
    }
    .order-card {
      display: flex;
      flex-direction: column;
      background: var(--card);
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: var(--shadow);
      margin-bottom: 1.5rem;
    }
    .order-filters {
      margin-bottom: 1.5rem;
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .filter-btn {
      background: var(--primary);
      color: var(--white);
      border: none;
      border-radius: 8px;
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .filter-btn:hover {
      background: var(--accent);
      color: var(--primary);
      transform: translateY(-2px);
    }

    .filter-btn.active {
      background: var(--accent);
      color: var(--primary);
      font-weight: 600;
    }

    .orders-container {
      overflow-x: auto;
      border-radius: 12px;
      background: var(--card);
      box-shadow: var(--shadow);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0;
    }

    th, td {
      padding: 0.8rem;
      text-align: left;
      border-bottom: 1px solid var(--accent);
      color: var(--text);
    }

    th {
      background: var(--primary);
      color: var(--white);
      font-weight: 600;
    }

    tr:hover {
      background: var(--accent);
    }

    .order-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
    }

    .order-actions button {
      background: var(--primary);
      color: var(--white);
      border: none;
      border-radius: 8px;
      padding: 0.6rem 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .order-actions button:hover {
      background: var(--accent);
      color: var(--primary);
      transform: translateY(-2px);
    }

    .overview-widget.clickable {
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .overview-widget.clickable:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow), 0 4px 12px rgba(161,130,201,0.2);
    }

    #orderSearch {
      transition: box-shadow 0.3s ease;
    }

    #orderSearch:focus {
      outline: none;
      box-shadow: 0 0 0 2px var(--primary);
    }

    .order-filters {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .order-actions button[style*="background:#4a90e2"]:hover {
  background: #357abd !important;
  color: var(--white);
}

#proofModal img {
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  transition: transform 0.3s ease;
}

#proofModal img:hover {
  transform: scale(1.02);
}
  </style>
</head>
<body>
  <header>
    <div class="logo">Scentora</div>
    <div class="header_contents">
      <div class="nav-links">
        <a href="dashboard.html">Dashboard</a>
        <a href="inventory_seller.html">Inventory</a>
        <a href="shop.html">Shop</a>
        <a href="#logout" id="logout-link">Logout</a>
      </div>
      <div class="toggle-switch">
        <label for="darkmode">Dark mode</label>
        <input type="checkbox" id="darkmode" title="Toggle dark mode" />
      </div>
    </div>
  </header>

  <div class="dashboard-container">
    <aside class="sidebar">
      <h3>Dashboard</h3>
      <a href="#" id="overview-link" class="active" onclick="showPage('overview', event)">Overview</a>
      <a href="#" id="stats-link" onclick="showPage('stats', event)">Statistics</a>
      <a href="#" id="orders-link" onclick="showPage('orders', event)">Orders</a>
    </aside>

    <section class="dashboard-main">
      <div id="overview" class="dashboard-page active">
        <div class="welcome-card">
          Welcome to your <strong>Scentora Dashboard</strong>!
        </div>
        <div class="quick-links">
          <a class="quick-link" href="inventory_seller.html">View Inventory</a>
        </div>
        <div class="overview-grid">
          <div class="overview-widget">Perfume Products<br><span id="count-products">--</span></div>
          <div class="overview-widget">Stock Alerts<br><span id="count-alerts">--</span></div>
          <div class="overview-widget clickable" onclick="goToPendingOrders()">
    New Orders<br><span id="count-orders">--</span>
  </div>
        </div>
      </div>

      <div id="stats" class="dashboard-page">
        <h2 style="color:var(--primary);">Statistics Overview</h2>
        <div class="overview-grid">
          <div class="stat-card"><h4>Total Perfumes</h4><p id="stat-total">0</p></div>
          <div class="stat-card"><h4>In Stock</h4><p id="stat-in-stock">0</p></div>
          <div class="stat-card"><h4>Out of Stock</h4><p id="stat-out-stock">0</p></div>
          <div class="stat-card"><h4>Total Orders</h4><p id="stat-orders">0</p></div>
        </div>
      </div>
      
      <div id="orders" class="dashboard-page">
        <h2 style="color:var(--primary);">Orders</h2>
        <div class="order-filters">
  <div style="width: 100%; max-width: 300px; margin-bottom: 1rem;">
    <input type="search" id="orderSearch" placeholder="Search Order ID..." 
    style="width: 100%; padding: 0.8rem; border-radius: 8px; border: 1px solid var(--primary); 
    background: var(--background); color: var(--text);">
  </div>
  <div style="display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; width: 100%;">
    <button class="filter-btn active" data-status="all">All Orders</button>
    <button class="filter-btn" data-status="Pending">Pending</button>
    <button class="filter-btn" data-status="Declined">Declined</button>
    <button class="filter-btn" data-status="Accepted">Accepted</button>
    <button class="filter-btn" data-status="Completed">Completed</button>
    <button class="filter-btn" data-status="Cancelled">Cancelled</button>
  </div>
</div>
        <div class="orders-container">
          <table id="ordersTable">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Customer</th>
                <th>Date</th>
                <th>Total</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="ordersList"></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>
  <div id="overrideModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
background:rgba(0,0,0,0.5); z-index:1001;">
  <div style="position:relative; top:50%; left:50%; transform:translate(-50%,-50%); 
  background:var(--card); padding:2rem; border-radius:12px; width:300px;">
    <h3 style="color:var(--primary); margin-top:0;">Override Order Status</h3>
    <!-- Update the overrideStatus select options -->
<select id="overrideStatus" style="width:100%; padding:0.5rem; margin:1rem 0; 
background:var(--background); color:var(--text); border:1px solid var(--primary);">
  <option value="Pending">Pending</option>
  <option value="Accepted">Accepted</option>
  <option value="Declined">Declined</option>
  <option value="Cancelled">Cancelled</option>
  <option value="Completed">Completed</option>
</select>
    <div style="display:flex; gap:1rem; justify-content:flex-end;">
      <button onclick="closeOverrideModal()" style="padding:0.5rem 1rem; border:none; 
      border-radius:4px; background:var(--accent); color:var(--text);">Cancel</button>
      <button onclick="submitOverride()" style="padding:0.5rem 1rem; border:none; 
      border-radius:4px; background:var(--primary); color:var(--white);">Update</button>
    </div>
  </div>
</div>
<div id="proofModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
background:rgba(0,0,0,0.5); z-index:1001;">
  <div style="position:relative; top:50%; left:50%; transform:translate(-50%,-50%); 
  background:var(--card); padding:2rem; border-radius:12px; max-width:500px; width:90%;">
    <h3 style="color:var(--primary); margin-top:0;">Proof of Payment</h3>
    <div style="margin: 1rem 0; text-align: center;">
      <img id="proofImage" src="" alt="Payment Proof" 
           style="max-width:100%; max-height:70vh; border-radius:8px; display:none; margin:0 auto;">
      <div id="imageError" style="display:none; color:red; margin-top:1rem;">
        Failed to load image. Please check the file path.
      </div>
    </div>
    <div style="display:flex; justify-content:flex-end;">
      <button onclick="closeProofModal()" style="padding:0.5rem 1rem; border:none; 
      border-radius:4px; background:var(--accent); color:var(--text);">Close</button>
    </div>
  </div>
</div>
  <script>
    //Sidebar navigation
function showPage(page, event) {
  event.preventDefault();
  document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
  document.querySelectorAll('.dashboard-page').forEach(p => p.classList.remove('active'));
  document.getElementById(`${page}-link`).classList.add('active');
  document.getElementById(page).classList.add('active');
}

//Dark mode toggle
const darkToggle = document.getElementById('darkmode');
if (localStorage.getItem('scentoraDark') === '1') {
  document.body.classList.add('darkmode');
  darkToggle.checked = true;
}
darkToggle.addEventListener('change', () => {
  document.body.classList.toggle('darkmode', darkToggle.checked);
  localStorage.setItem('scentoraDark', darkToggle.checked ? '1' : '0');
});

//Logout confirmation
document.getElementById("logout-link").onclick = function(e) {
  e.preventDefault();
  if (confirm("Are you sure you want to logout?")) {
    window.location.href = "/IM2-Scentora/files/admin/loginpage.php";
  }
};

//Real-time dashboard data fetch
fetch("dashboard_data.php")
  .then(res => res.json())
  .then(data => {
    // Overview section
    document.getElementById("count-products").textContent = data.totalProducts;
    document.getElementById("count-alerts").textContent = data.stockAlerts;
    document.getElementById("count-orders").textContent = data.pendingOrders;
    
    // Stats section
    document.getElementById("stat-total").textContent = data.totalProducts;
    document.getElementById("stat-in-stock").textContent = data.inStock;
    document.getElementById("stat-out-stock").textContent = data.outOfStock;
    document.getElementById("stat-orders").textContent = data.totalOrders;
  })
  .catch(err => {
    console.error("Dashboard fetch failed:", err);
  });
  let currentOrderId = null;

function showOverrideModal(orderId) {
  currentOrderId = orderId;
  document.getElementById('overrideModal').style.display = 'block';
}

function closeOverrideModal() {
  document.getElementById('overrideModal').style.display = 'none';
  currentOrderId = null;
}

function submitOverride() {
  if (!currentOrderId) return;
  
  const newStatus = document.getElementById('overrideStatus').value;
  changeOrderStatus(currentOrderId, newStatus);
  closeOverrideModal();
}

// Close modal when clicking outside
document.getElementById('overrideModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeOverrideModal();
  }
});

function changeOrderStatus(orderId, newStatus) {
  // Add console.log for debugging
  console.log('Updating order:', orderId, 'to status:', newStatus);
  
  fetch("update_order_status.php", {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    },
    body: `order_id=${orderId}&status=${newStatus}`
  })
  .then(res => res.text())
  .then(result => {
    console.log('Server response:', result); // Debug log
    if (result.trim() === "updated") {
      alert("Order status changed to: " + newStatus);
      loadOrders(); // Refresh the orders list
    } else {
      alert("Failed to update status: " + result);
    }
  })
  .catch(err => {
    console.error("Error:", err);
    alert("An error occurred while updating the status");
  });
}
// Replace the existing renderOrders function
function renderOrders(data) {
  const container = document.getElementById("ordersList");

  if (!data.length) {
    container.innerHTML = "<tr><td colspan='6' style='text-align:center;'>No Orders to display.</td></tr>";
    return;
  }

  container.innerHTML = "";
  data.forEach(order => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${order.order_id}</td>
      <td>${order.buyer_name}</td>
      <td>${new Date(order.order_date).toLocaleString()}</td>
      <td>â‚±${order.total}</td>
      <td>${order.status}</td>
      <td>
        <div class="order-actions">
          ${order.status === 'Pending' ? `
            <button onclick="changeOrderStatus(${order.order_id}, 'Accepted')">Accept</button>
            <button onclick="changeOrderStatus(${order.order_id}, 'Declined')">Decline</button>
          ` : ''}
          ${order.payment_proof ? 
            `<button onclick="showProofModal('${order.payment_proof.split('/').pop()}')" 
            style="background:#4a90e2;">View Proof</button>` : 
            '<span style="color:var(--text);font-size:0.9rem;">No proof uploaded</span>'
          }
          <button onclick="showOverrideModal(${order.order_id})" 
          style="background:#6b5097;">Override</button>
        </div>
      </td>
    `;
    container.appendChild(row);
  });
}

function loadOrders(statusFilter = 'all') {
  const searchTerm = document.getElementById('orderSearch').value;
  
  fetch("orders_fetch.php")
    .then(res => res.json())
    .then(data => {
      const filteredData = filterOrders(data, statusFilter, searchTerm);
      renderOrders(filteredData);
    })
    .catch(() => {
      document.getElementById("ordersList").innerHTML = 
        "<tr><td colspan='6' style='text-align:center;'>Error loading orders.</td></tr>";
    });
}

function filterOrders(orders, statusFilter = 'all', searchTerm = '') {
  return orders.filter(order => {
    const matchesStatus = statusFilter === 'all' || order.status === statusFilter;
    const matchesSearch = searchTerm === '' || 
                         order.order_id.toString().includes(searchTerm.trim());
    return matchesStatus && matchesSearch;
  });
}

// Add search event listener
document.getElementById('orderSearch').addEventListener('input', function() {
  const activeFilter = document.querySelector('.filter-btn.active').getAttribute('data-status');
  loadOrders(activeFilter);
});

// Filter buttons functionality
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    const status = this.getAttribute('data-status');
    loadOrders(status);
  });
});

// Load orders on page ready
document.addEventListener("DOMContentLoaded", () => {
  loadOrders();
});

function goToPendingOrders() {
  // Show the orders page
  showPage('orders', { preventDefault: () => {} });
  
  // Set filter to Pending
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.classList.remove('active');
    if(btn.getAttribute('data-status') === 'Pending') {
      btn.classList.add('active');
    }
  });
  
  // Load pending orders
  loadOrders('Pending');
}

// Add this in your script section
function showProofModal(proofUrl) {
  const proofModal = document.getElementById('proofModal');
  const proofImage = document.getElementById('proofImage');
  const imageError = document.getElementById('imageError');
  
  // Reset error message and image
  imageError.style.display = 'none';
  proofImage.style.display = 'none';

  // Show loading state
  proofModal.style.display = 'block';
  
  // Construct proper path based on the proof URL
  let imagePath;
  if (proofUrl.includes('/uploads/proofs/')) {
    imagePath = proofUrl; // Full path already included
  } else {
    // Adjust path to point to user folder
    imagePath = `../user/uploads/proofs/${proofUrl.split('/').pop()}`;
  }

  // Add console log for debugging
  console.log('Attempting to load image from:', imagePath);

  // Create a new image to test loading
  const testImage = new Image();
  testImage.onload = function() {
    proofImage.src = imagePath;
    proofImage.style.display = 'block';
  };

  testImage.onerror = function() {
    console.error('Failed to load image from path:', imagePath);
    imageError.style.display = 'block';
    proofImage.style.display = 'none';
  };

  testImage.src = imagePath;
}

function closeProofModal() {
  const proofModal = document.getElementById('proofModal');
  const proofImage = document.getElementById('proofImage');
  const imageError = document.getElementById('imageError');
  
  proofModal.style.display = 'none';
  proofImage.src = '';
  imageError.style.display = 'none';
}

// Close modal when clicking outside
document.getElementById('proofModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeProofModal();
  }
});
  </script>
  </script>
</body>
</html>
